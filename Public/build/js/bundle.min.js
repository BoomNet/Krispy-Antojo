let sidebar=document.querySelector(".sidebar"),closeBtn=document.querySelector("#btn");const Logout=document.querySelector("#logout"),BtnUpdateSpending=document.querySelectorAll(".btn-gasto"),Modal=document.querySelector("#modal-gasto"),DeleteSpending=document.querySelectorAll("#btn-eliminar"),IdScript=document.querySelector("#test-id"),Update=document.querySelector(".updateSpendig"),ModalAdd=document.querySelector(".add"),CloseModal=document.querySelector(".btn-close"),User=document.querySelector(".user"),Categoria=document.querySelector("#categoria"),InputProducto=document.querySelector("#producto"),Venta=document.querySelector(".agregarProducto"),Detalles=document.querySelector("#detallesBody"),CantidadPagar=document.querySelector("#cantidadPagar"),Cancelar=document.querySelector(".btn-cancelar"),FinalizarVenta=document.querySelector("#finalizarVenta");let Id,view,ProductosDonas,objVentaProductos={cveusuario_venta:"",total_venta:"",cantidad_venta:"",pago_venta:"",cambio_venta:""},TotalDetalle=0,TotalVenta=0,SpendingData=[],InfoProducto=[],DetalleVenta=[],InfoDetalle=[],objVenta={id:"",nombre_producto:"",descripcion_producto:"",precioVenta_producto:""},CantidadProductos=0,CantidadTotalProductos=0;function UserRol(){User&&User.remove()}function CalcPrevisto(){document.querySelectorAll("#diferenteTable").forEach(e=>{parseInt(e.textContent)<0?e.classList.add("text-danger"):e.classList.remove("text-danger")})}function menuBtnChange(){sidebar.classList.contains("open")?closeBtn.classList.replace("bx-menu","bx-menu-alt-right"):closeBtn.classList.replace("bx-menu-alt-right","bx-menu")}function ModalView(e){e.preventDefault();const t=document.querySelector("#descripcion"),a=document.querySelector("#previsto"),o=document.querySelector("#real");t.value="",a.value="",o.value=""}async function GetSpending(){const e=await fetch("http://localhost:3000/Dashboard/getGasto",{method:"GET"});return await e.json()}function ClassUpdate(e){e.preventDefault(),Modal.classList.contains("update")&&Modal.classList.remove("update")}function getId(e){e.preventDefault(),Modal.classList.add("update");let t="";switch(e.target.nodeName){case"path":t=e.target.parentElement.parentElement.id;break;case"svg":t=e.target.parentElement.id;break;default:t=e.target.id}document.querySelector("#idgasto").value=t,AddValues(SpendingData.find(e=>e.id===t))}function AddValues(e){document.querySelector("#descripcion").value=e.descripcion_gasto,document.querySelector("#previsto").value=e.previsto_gasto,document.querySelector("#real").value=e.real_gasto||""}async function addSpending(e){try{if(e.preventDefault(),Modal.classList.contains("update"))updateSpendig();else{ValidarModal();const e=new FormData(Modal),t="http://localhost:3000/Dashboard/modal",a=await fetch(t,{method:"POST",body:e});(await a.json()).resultado&&Swal.fire({icon:"success",title:"Gasto agregado",text:"Tu gasto fue agregado correctamente",button:"OK"}).then(()=>{setTimeout(()=>{window.location.href="http://localhost:3000/Dashboard/dashboard?View=8&id="+Id},1e3)})}}catch(e){Swal.fire({icon:"error",title:"Error",text:"Hubo un error al guardar tu gasto"})}}async function updateSpendig(){try{const e=document.querySelector("#idgasto").value,t="http://localhost:3000/Dashboard/editar-gasto",a=new FormData;a.append("id",e),a.append("descripcion_previsto",document.querySelector("#descripcion").value),a.append("previsto_gasto",document.querySelector("#previsto").value),a.append("real_gasto",document.querySelector("#real").value);const o=await fetch(t,{method:"POST",body:a});(await o.json()).resultado&&(Swal.fire({icon:"success",title:"Gasto Actualizado",text:"Tu gasto fue actualizado correctamente",button:"OK"}).then(()=>{window.location.href="http://localhost:3000/Dashboard/dashboard?View=8&id="+Id}),Modal.classList.remove("update"))}catch(e){console.log(e)}}async function deleteSpen(e){try{e.preventDefault();const t=document.querySelector("#eliminar-gasto").value,a=new FormData;a.append("id",t);const o="http://localhost:3000/Dashboard/eliminar-gasto",n=await fetch(o,{method:"POST",body:a});(await n.json()).guardado&&Swal.fire({icon:"success",title:"Gasto Eliminado",text:"Tu gasto fue eliminado correctamente",button:"OK"}).then(()=>{window.location.reload()})}catch(e){Swal.fire({icon:"error",title:"Error",text:"Hubo un error al guardar tu gasto"})}}function ValidarModal(){const e=document.querySelector("#descripcion").value,t=document.querySelector("#previsto").value;""!==e&&""!==t||ImprimirAlerta("Descripción y/o Gasto previsto Obligatorio")}function ImprimirAlerta(e){const t=document.querySelector(".errores-modal");t.classList.contains("error-alerta")||(t.textContent=e,t.classList.add("error-alerta")),setTimeout(()=>{t.classList.remove("error-alerta"),t.textContent=""},5e3)}async function ObtenerCategoria(){try{const e="http://localhost:3000/Dashboard/venta",t=await fetch(e,{method:"GET"}),a=await t.json();for(let e=0;e<a.resultado.length;e++){const{id:t,nombre_categoria:o}=a.resultado[e];MostrarCategoria(t,o)}}catch(e){console.log(e)}}function MostrarCategoria(e,t){const a=document.createElement("OPTION");a.value=e,a.textContent=t,Categoria.appendChild(a)}async function categoriaSeleccionada(e){e.preventDefault();let t=e.target.selectedIndex;e.target.options[t].text;await ProductoSeleccionado().then(e=>{InfoProducto.push(...e.resultado)}).catch(e=>{console.log(e)});let a=new Set(InfoProducto.map(JSON.stringify)),o=Array.from(a).map(JSON.parse);ProductosDonas=o.filter(e=>parseInt(e.cvecategoria_producto)===t),MostrarProductos(ProductosDonas)}async function ProductoSeleccionado(){const e=await fetch("http://localhost:3000/Dashboard/producto",{method:"GET"});return await e.json()}function MostrarProductos(e){LimpiarOption(),e.forEach(e=>{const{id:t,nombre_producto:a}=e,o=document.createElement("OPTION");o.value=t,o.textContent=a,InputProducto.appendChild(o)})}function MostrarDetalleVenta(e){e.preventDefault();const t=document.querySelector("#producto"),a=document.querySelector("#cantidad").value;let o=t.selectedIndex,n=t.options[o].text,r=ProductosDonas.filter(e=>e.nombre_producto===n),c={};r.forEach(e=>{const{id:t}=e;c={id:t,Cantidad:a}}),DetalleVenta=[...DetalleVenta,...r],DetalleVenta.forEach(e=>{const{id:t,nombre_producto:o,descripcion_producto:n,precioVenta_producto:r}=e;objVenta={id:t,nombre_producto:o,descripcion_producto:n,precioVenta_producto:r,Cantidad:a}});let d=1;if(InfoDetalle.some(e=>{if(parseInt(e.id)===parseInt(c.id))return d++,d>1})){const e=InfoDetalle.find(e=>e.id===c.id);let t=parseInt(e.Cantidad),o=parseInt(a);e.Cantidad=t+o}else InfoDetalle=[...InfoDetalle,objVenta];ImprimirDetalle(InfoDetalle)}function ImprimirDetalle(e){LimpiarTabla(),e.forEach(e=>{const{id:t,nombre_producto:a,descripcion_producto:o,precioVenta_producto:n,Cantidad:r}=e,c=document.createElement("TR"),d=document.createElement("TD");d.textContent=a;const l=document.createElement("TD");l.textContent=o;const i=document.createElement("TD");i.textContent=n;const s=document.createElement("TD");s.textContent=r,CantidadProductos+=parseInt(r);const u=document.createElement("TD");u.textContent="$"+n*r,TotalDetalle+=n*r;const p=document.createElement("TD"),m=document.createElement("BUTTON");m.onclick=()=>{EliminarProducto(t)},m.innerHTML='\n      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16">\n        <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>\n        <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>\n      </svg\n    ',m.classList.add("btn","eliminar"),p.appendChild(m),c.appendChild(d),c.appendChild(l),c.appendChild(i),c.appendChild(s),c.appendChild(u),c.appendChild(p),Detalles.appendChild(c)});let t=document.querySelector("#totalPagar")||0;TotalVenta=TotalDetalle,t.value=TotalVenta,TotalDetalle=0,CantidadTotalProductos=CantidadProductos,CantidadProductos=0,objVentaProductos.total_venta=TotalVenta,objVentaProductos.cantidad_venta=CantidadTotalProductos}function EliminarProducto(e){InfoDetalle.forEach(t=>{t.id===e&&(t.Cantidad>1?t.Cantidad--:InfoDetalle=InfoDetalle.filter(t=>t.id!==e))}),ImprimirDetalle(InfoDetalle)}function Cambio(e){let t=parseInt(e.target.value)||"";document.querySelector("#cambioPago").value=t-TotalVenta,objVentaProductos.pago_venta=t,objVentaProductos.cambio_venta=t-TotalVenta}function CancelarVenta(e){e.preventDefault();const t=Swal.mixin({customClass:{confirmButton:"btn btn-success",cancelButton:"btn btn-danger"},buttonsStyling:!1});t.fire({title:"¿Estas seguro de cancelar la venta?",text:"Esta accion no se puede revertir!",icon:"warning",showCancelButton:!0,confirmButtonText:"Si, Borrar!",cancelButtonText:"No, Cancelar!",reverseButtons:!0}).then(e=>{e.isConfirmed?(t.fire("Borrado!","Tu venta ha sido eliminada.","success"),window.location.href="http://localhost:3000/Dashboard/dashboard?View=9&id="+Id):e.dismiss===Swal.DismissReason.cancel&&t.fire("Cancelado","Tu venta ha sido conservada","error")})}async function AgregarVenta(e){try{e.preventDefault();const{cveusuario_venta:t,total_venta:a,cantidad_venta:o,pago_venta:n,cambio_venta:r}=objVentaProductos;if(""!==t&&""!==a&&""!==o&&""!==n&&""!==r){const e="http://localhost:3000/Dashboard/agregarVenta",c=new FormData;c.append("cveusuario_venta",t),c.append("total_venta",a),c.append("cantidad_venta",o),c.append("pago_venta",n),c.append("cambio_venta",r);const d=await fetch(e,{method:"POST",body:c});(await d.json()).resultado&&Swal.fire({icon:"success",title:"Venta agregada",text:"Tu venta fue agregado correctamente",button:"OK"}).then(()=>{setTimeout(()=>{window.location.href="http://localhost:3000/Dashboard/dashboard?View=9&id="+Id},1e3)})}else Swal.fire({icon:"error",title:"Oops...",text:"Faltas campos por llenar!"})}catch(e){Swal.fire({icon:"error",title:"Oops...",text:"Hubo un error al guardar tu venta!"})}}function LimpiarTabla(){for(;Detalles.firstChild;)Detalles.removeChild(Detalles.firstChild)}function LimpiarOption(){for(;InputProducto.firstChild;)InputProducto.removeChild(InputProducto.firstChild)}function Alert(e){e.preventDefault();Swal.mixin({customClass:{confirmButton:"btn btn-success",cancelButton:"btn btn-danger"},buttonsStyling:!1}).fire({title:"¿Estas seguro de cerrar sesión?",icon:"warning",showCancelButton:!0,confirmButtonText:"Si, seguro!",cancelButtonText:"No, cancelar!",reverseButtons:!0}).then(e=>{e.isConfirmed?window.location.href="/logout":e.dismiss===Swal.DismissReason.cancel&&Swal.close()})}document.addEventListener("DOMContentLoaded",async()=>{try{UserRol();const e=new URLSearchParams(window.location.search);Id=parseInt(e.get("id"));const t=new URLSearchParams(window.location.search);view=parseInt(t.get("View")),closeBtn.addEventListener("click",()=>{sidebar.classList.toggle("open"),menuBtnChange()}),await GetSpending().then(e=>{SpendingData.push(...e.resultado)}).catch(e=>{console.log(e)}),8===view&&(ModalAdd.addEventListener("click",ModalView),Modal.addEventListener("submit",addSpending),BtnUpdateSpending.forEach(e=>{e.addEventListener("click",getId)}),DeleteSpending.forEach(e=>{e.addEventListener("submit",deleteSpen)}),CloseModal.addEventListener("click",ClassUpdate),CalcPrevisto()),Logout.addEventListener("click",Alert),9===view&&(objVentaProductos.cveusuario_venta=Id,ObtenerCategoria(),Categoria.addEventListener("change",categoriaSeleccionada),Venta.addEventListener("click",MostrarDetalleVenta),CantidadPagar.addEventListener("blur",Cambio),Cancelar.addEventListener("click",CancelarVenta),FinalizarVenta.addEventListener("submit",AgregarVenta))}catch(e){console.log(e)}});
//# sourceMappingURL=bundle.js.map
